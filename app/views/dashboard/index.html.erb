<% content_for(:title, 'Dashboard') %>
<!-- Flash Messages -->
<% flash.each do |name, msg| %>
  <% if msg.is_a?(String) %>
    <div class="alert alert-<%= name == 'notice' ? 'success' : 'danger' %> alert-dismissible fade show" role="alert">
      <%= msg %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>
<% end %>

<div class="container mt-5">
  <div class="row">
    <div class="col-md-5">
      <h1>Good Morning<% if user_signed_in? %>, <%= @user.full_name %><% end %></h1>
      <p>Welcome to your dashboard</p>
      <div class="points-summary mt-5 p-4 bg-white rounded shadow text-center">
        <h4>Points Summary</h4>
        <div class="total-points mt-3">
          <h2>Total Points: <span class="points-value">150</span></h2>
        </div>
        <%= require_sign_in do %>
          <h2> <%= link_to 'View Leaderboard', leaderboard_index_path %> </h2>
        <% end %>
      </div>
    </div>

    <!-- Announcement Column -->
    <div class="col-md-7">
      <div class="announcements bg-light rounded p-4 shadow">
        <h4>Latest Announcements</h4>
        <div class="announcement-list mt-3">
          <% @announcements.each do |announcement| %>
            <div class="announcement bg-info-subtle shadow-lg rounded p-3 mb-3">
              <div class="d-flex align-items-center mb-2">
                <div class="avatar rounded-circle overflow-hidden mr-3" style="width: 40px; height: 40px;">
                  <%= image_tag User.find_by(uid: announcement.googleUserID).avatar_url, alt: "User Avatar", class: "img-fluid" %>
                </div>
                <h5 class="mb-0"><%= announcement.subject %></h5>
              </div>
              <p class="text-muted mb-1"><%= announcement.dateOfAnnouncement.in_time_zone.strftime("%b %d, %Y, %I:%M %p %Z") %></p>
              <p class="mb-0"><%= truncate_with_link(announcement.body, 100, announcement_path(announcement)) %></p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Events Section -->
  <div class="events mt-4 bg-white rounded p-4 shadow">
    <h4>Upcoming Events</h4>
    <ul class="list-unstyled mt-3">
      <% @events.sort_by(&:eventTime).each do |event| %>
        <li class="event mb-3 p-3 bg-light rounded">
          <div class="d-flex justify-content-between">
            <div>
              <div class="event-date text-primary"><strong><%= event.eventTime.strftime("%A, %B %-d") %></strong></div>
              <div class="event-details">
                <h5 class="event-title mb-1"><%= event.eventName %></h5>
                <p class="event-time text-muted"><%= event.eventTime.strftime("%H:%M") %></p>
                <p class="event-location text-muted mb-0"><%= event.eventLocation %></p>
              </div>
            </div>
            <a href="/rsvp?event_id=<%= event.id %>" class="btn btn-primary align-self-start">RSVP</a>
          </div>
        </li>
      <% end %>
    </ul>
  </div>


</div>

<% content_for(:extra_js) do %>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<% end %>